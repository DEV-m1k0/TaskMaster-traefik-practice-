<!DOCTYPE html>
<html lang="ru" class="scroll-smooth">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="description" content="TaskMaster — простой и красивый менеджер задач" />
  <title>{% block title %}TaskMaster{% endblock %}</title>

  <!-- Google Font -->
  <link rel="preconnect" href="https://fonts.gstatic.com">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&display=swap" rel="stylesheet">

  <!-- Tailwind Play CDN (good for prototyping). For production, build Tailwind in your pipeline -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: '#7C3AED', /* violet-600 */
            accent: '#06B6D4'   /* cyan-500 */
          },
          fontFamily: {
            sans: ['Inter', 'ui-sans-serif', 'system-ui']
          }
        }
      }
    }
  </script>

  {% block head_extra %}{% endblock %}

  <style>
    /* small visual polish */
    .glass {
      background: linear-gradient(180deg, rgba(255,255,255,0.6), rgba(255,255,255,0.4));
      backdrop-filter: blur(6px);
    }
  </style>
</head>
<body class="min-h-screen bg-gray-50 text-gray-800 font-sans dark:bg-gray-900 dark:text-gray-100">

  <!-- NAVBAR -->
  <header class="sticky top-0 z-40 shadow-sm bg-white/60 dark:bg-gray-800/60 glass">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="flex justify-between items-center h-16">
        <a href="{{ url_for('index') }}" class="flex items-center gap-3">
          <div class="w-9 h-9 rounded-lg bg-gradient-to-br from-primary to-accent flex items-center justify-center text-white font-bold">TM</div>
          <div class="hidden sm:block">
            <span class="text-lg font-semibold">TaskMaster</span>
            <div class="text-xs text-gray-500 dark:text-gray-400">Управляй задачами красиво</div>
          </div>
        </a>

        <div class="flex items-center gap-3">
          <!-- Flash / auth buttons -->
          {% if current_user is defined and current_user.is_authenticated %}
            <a href="#" class="hidden sm:inline-flex items-center gap-2 px-3 py-1.5 rounded-md border border-gray-200 dark:border-gray-700">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true"><path fill-rule="evenodd" d="M10 2a4 4 0 100 8 4 4 0 000-8zM2 18a8 8 0 1116 0H2z" clip-rule="evenodd"/></svg>
              <span class="text-sm">Профиль</span>
            </a>
            <form method="POST" action="{{ url_for('auth.logout') }}">
              <button type="submit" class="px-3 py-1.5 rounded-md bg-red-50 text-red-600 text-sm hover:bg-red-100">Выйти</button>
            </form>
          {% else %}
            <a href="{{ url_for('login') }}" class="px-3 py-1.5 rounded-md text-sm font-medium hover:bg-gray-100 dark:hover:bg-gray-700">Вход</a>
            <a href="{{ url_for('register') }}" class="px-3 py-1.5 rounded-md bg-primary text-white text-sm font-medium hover:opacity-95">Регистрация</a>
          {% endif %}

          <!-- Mobile menu button -->
          <button id="mobile-menu-button" aria-expanded="false" aria-label="Открыть меню" class="md:hidden p-2 rounded-md hover:bg-gray-100 dark:hover:bg-gray-700">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" /></svg>
          </button>
        </div>
      </div>

      <!-- Mobile nav -->
      <div id="mobile-menu" class="md:hidden hidden pb-4">
        <div class="flex flex-col gap-2">
          <a href="#" class="px-3 py-2 rounded-md">Задачи</a>
          <a href="#" class="px-3 py-2 rounded-md">Создать</a>
          <a href="#" class="px-3 py-2 rounded-md">О проекте</a>
        </div>
      </div>
    </div>
  </header>

  <!-- FLASH MESSAGES -->
  <div class="max-w-3xl mx-auto px-4 sm:px-6 lg:px-8 mt-6">
    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        <div class="space-y-2">
          {% for category, msg in messages %}
            <div class="p-3 rounded-md text-sm shadow-sm {% if category == 'success' %}bg-green-50 text-green-800{% elif category == 'error' or category == 'danger' %}bg-red-50 text-red-800{% else %}bg-blue-50 text-blue-800{% endif %}">
              {{ msg | safe }}
            </div>
          {% endfor %}
        </div>
      {% endif %}
    {% endwith %}
  </div>

  <!-- MAIN CONTENT -->
  <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    {% block content %}
    <!-- Страницы будут вставлять сюда свой контент -->
    <section class="text-center py-20">
      <h1 class="text-3xl md:text-4xl font-extrabold">Добро пожаловать в TaskMaster</h1>
      <p class="mt-4 text-gray-600 dark:text-gray-300 max-w-2xl mx-auto">Создавайте и управляйте задачами быстро — красивый интерфейс, понятные формы и адаптивность на всех устройствах.</p>
    </section>
    {% endblock %}
  </main>

  <!-- FOOTER -->
  <footer class="border-t border-gray-200 dark:border-gray-700 mt-12">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6 flex flex-col md:flex-row items-center justify-between gap-4">
      <div class="flex items-center gap-3">
        <div class="w-8 h-8 rounded bg-gradient-to-br from-primary to-accent flex items-center justify-center text-white font-bold">TM</div>
        <div class="text-sm text-gray-600 dark:text-gray-400">© {{ current_year if current_year is defined else '' }} TaskMaster</div>
      </div>
      <div class="text-sm text-gray-500 dark:text-gray-400">Создано с ❤️ — удобный менеджер задач</div>
    </div>
  </footer>

  {% block scripts %}
  <script>
    // Mobile menu toggle
    (function(){
      const btn = document.getElementById('mobile-menu-button');
      const menu = document.getElementById('mobile-menu');
      if(!btn || !menu) return;
      btn.addEventListener('click', ()=>{
        const open = menu.classList.toggle('hidden');
        btn.setAttribute('aria-expanded', String(!open));
      });
    })();

    // Simple dark-mode toggle based on prefers-color-scheme and localStorage
    (function(){
      const html = document.documentElement;
      const stored = localStorage.getItem('tm-theme');
      if(stored === 'dark') html.classList.add('dark');
      else if(stored === 'light') html.classList.remove('dark');
      else if(window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) html.classList.add('dark');

      window.toggleTheme = function(mode){
        if(mode === 'dark') { html.classList.add('dark'); localStorage.setItem('tm-theme','dark'); }
        else if(mode === 'light'){ html.classList.remove('dark'); localStorage.setItem('tm-theme','light'); }
        else { html.classList.toggle('dark'); localStorage.setItem('tm-theme', html.classList.contains('dark') ? 'dark' : 'light'); }
      }
    })();
  </script>
  {% endblock %}

</body>
</html>

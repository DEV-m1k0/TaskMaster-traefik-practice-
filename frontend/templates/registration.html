{% extends 'base.html' %}
{% block title %}Регистрация — TaskMaster{% endblock %}

{% block content %}
<!-- Improved, airy and more attractive registration layout -->
<div class="max-w-7xl mx-auto px-6 lg:px-12 py-16">
  <div class="grid grid-cols-1 lg:grid-cols-12 gap-8 items-center">

    <!-- LEFT: Form (takes larger space) -->
    <div class="lg:col-span-7">
      <div class="bg-white dark:bg-gray-900 rounded-2xl shadow-lg border border-gray-100 dark:border-gray-800 p-8 lg:p-12">
        <div class="flex items-start justify-between gap-4">
          <div>
            <div class="inline-flex items-center gap-3">
              <div class="w-12 h-12 rounded-xl bg-gradient-to-br from-primary to-accent flex items-center justify-center text-white font-bold">TM</div>
              <div>
                <h1 class="text-2xl lg:text-3xl font-extrabold leading-tight">Создайте аккаунт и начните управлять задачами эффективнее</h1>
                <p class="mt-2 text-sm text-gray-500 dark:text-gray-400 max-w-xl">Быстрая регистрация, чистый интерфейс и инструменты для приоритизации — всё, чтобы добиваться результата каждый день.</p>
              </div>
            </div>
          </div>
        </div>

        <form method="POST" action="{{ url_for('register') }}" class="mt-8 space-y-6" novalidate>
          {% if form is defined %}
            {{ form.csrf_token }}
          {% endif %}

          <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
            <div>
              <label for="first_name" class="block text-sm font-medium text-gray-700 dark:text-gray-200">Имя</label>
              {% if form is defined and form.first_name is defined %}
                {{ form.first_name(class='mt-1 block w-full rounded-lg border-gray-200 dark:border-gray-700 shadow-sm px-3 py-2') }}
                {% if form.first_name.errors %}
                  <p class="text-xs text-red-600 mt-1">{{ form.first_name.errors[0] }}</p>
                {% endif %}
              {% else %}
                <input id="first_name" name="first_name" type="text" class="text-black mt-1 block w-full rounded-lg border border-gray-200 dark:border-gray-700 px-3 py-2" value="{{ request.form.first_name if request.form.first_name is defined else '' }}">
              {% endif %}
            </div>

            <div>
              <label for="last_name" class="block text-sm font-medium text-gray-700 dark:text-gray-200">Фамилия</label>
              {% if form is defined and form.last_name is defined %}
                {{ form.last_name(class='mt-1 block w-full rounded-lg border-gray-200 dark:border-gray-700 shadow-sm px-3 py-2') }}
                {% if form.last_name.errors %}
                  <p class="text-xs text-red-600 mt-1">{{ form.last_name.errors[0] }}</p>
                {% endif %}
              {% else %}
                <input id="last_name" name="last_name" type="text" class="text-black mt-1 block w-full rounded-lg border border-gray-200 dark:border-gray-700 px-3 py-2" value="{{ request.form.last_name if request.form.last_name is defined else '' }}">
              {% endif %}
            </div>
          </div>

          <div>
            <label for="email" class="block text-sm font-medium text-gray-700 dark:text-gray-200">Email</label>
            {% if form is defined and form.email is defined %}
              {{ form.email(class='mt-1 block w-full rounded-lg border-gray-200 dark:border-gray-700 shadow-sm px-3 py-2') }}
              {% if form.email.errors %}
                <p class="text-xs text-red-600 mt-1">{{ form.email.errors[0] }}</p>
              {% endif %}
            {% else %}
              <input id="email" name="email" type="email" required class="text-black mt-1 block w-full rounded-lg border border-gray-200 dark:border-gray-700 px-3 py-2" value="{{ request.form.email if request.form.email is defined else '' }}">
            {% endif %}
          </div>

          <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
            <div>
              <label for="password" class="block text-sm font-medium text-gray-700 dark:text-gray-200">Пароль</label>
              <div class="relative">
                {% if form is defined and form.password is defined %}
                  {{ form.password(class='mt-1 block w-full rounded-lg border-gray-200 dark:border-gray-700 shadow-sm px-3 py-2 pr-12') }}
                {% else %}
                  <input id="password" name="password" type="password" required class="text-black mt-1 block w-full rounded-lg border border-gray-200 dark:border-gray-700 px-3 py-2 pr-12">
                {% endif %}

                <button type="button" onclick="togglePassword('password')" class="absolute right-3 top-1/2 -translate-y-1/2 text-sm text-gray-500 hover:text-gray-700">Показать</button>
              </div>
            </div>

            <div>
              <label for="password_confirm" class="block text-sm font-medium text-gray-700 dark:text-gray-200">Подтвердите пароль</label>
              <div class="relative">
                {% if form is defined and form.password_confirm is defined %}
                  {{ form.password_confirm(class='mt-1 block w-full rounded-lg border-gray-200 dark:border-gray-700 shadow-sm px-3 py-2 pr-12') }}
                {% else %}
                  <input id="password_confirm" name="password_confirm" type="password" required class="text-black mt-1 block w-full rounded-lg border border-gray-200 dark:border-gray-700 px-3 py-2 pr-12">
                {% endif %}

                <button type="button" onclick="togglePassword('password_confirm')" class="absolute right-3 top-1/2 -translate-y-1/2 text-sm text-gray-500 hover:text-gray-700">Показать</button>
              </div>
            </div>
          </div>

          <!-- Password strength and match -->
          <div>
            <div class="flex items-center gap-4">
              <div class="flex-1">
                <div id="pw-help" class="mt-2 text-xs text-gray-500"></div>
              </div>
              <div id="pw-status" class="text-sm font-medium text-gray-500 w-40 text-right"></div>
            </div>
          </div>

          <div class="flex items-center gap-3">
            <label class="inline-flex items-center gap-2 text-sm">
              <input type="checkbox" name="agree" id="agree_terms" class="rounded border-gray-200 dark:border-gray-700"> 
              <span class="text-gray-500">Я принимаю <a href="#" class="text-primary">условия использования</a> и <a href="#" class="text-primary">политику конфиденциальности</a></span>
            </label>
          </div>

          <div class="pt-2">
            <button id="register-btn" type="submit" class="w-full inline-flex items-center justify-center gap-2 px-4 py-3 rounded-lg bg-primary text-white font-semibold shadow-lg">Создать аккаунт</button>
          </div>

        </form>

        <div class="mt-6 text-center text-sm text-gray-500 sm:hidden">Уже есть аккаунт? <a href="{{ url_for('login') }}" class="text-primary font-semibold">Войти</a></div>
      </div>

      <!-- subtle helper row -->
      <div class="mt-4 text-xs text-gray-400">Безопасность паролей: рекомендуем минимум 8 символов, смесь букв и цифр.</div>
    </div>

    <!-- RIGHT: Illustration / benefits (vertical on wide screens) -->
    <div class="lg:col-span-5">
      <div class="relative rounded-2xl overflow-hidden p-8 lg:p-12 bg-gradient-to-br from-primary/8 to-accent/6 border border-gray-100 dark:border-gray-800">
        <!-- Decorative large SVG illustration -->
        <div class="hidden md:block absolute inset-0 opacity-20 pointer-events-none">
          <!-- simple abstract SVG shapes for visual interest -->
          <svg class="w-full h-full" viewBox="0 0 800 600" fill="none" xmlns="http://www.w3.org/2000/svg">
            <circle cx="120" cy="100" r="80" fill="url(#g1)" />
            <rect x="300" y="200" width="240" height="140" rx="24" fill="url(#g2)" />
            <defs>
              <linearGradient id="g1" x1="0" x2="1"><stop offset="0" stop-color="#7C3AED" stop-opacity="0.7" /><stop offset="1" stop-color="#06B6D4" stop-opacity="0.7" /></linearGradient>
              <linearGradient id="g2" x1="0" x2="1"><stop offset="0" stop-color="#06B6D4" stop-opacity="0.6" /><stop offset="1" stop-color="#7C3AED" stop-opacity="0.6" /></linearGradient>
            </defs>
          </svg>
        </div>

        <div class="relative z-10">
          <h3 class="text-xl lg:text-2xl font-extrabold">Почему TaskMaster?</h3>
          <p class="mt-3 text-gray-600 dark:text-gray-300">Инструмент создан для тех, кто любит порядок и хочет получать результат, не теряя времени на лишние настройки.</p>

          <ul class="mt-6 space-y-4">
            <li class="flex items-start gap-3">
              <div class="mt-1 w-10 h-10 rounded-lg bg-white/60 dark:bg-gray-900/60 flex items-center justify-center font-semibold">✓</div>
              <div>
                <div class="font-semibold">Интуитивные шаблоны</div>
                <div class="text-sm text-gray-500">Готовые структуры задач, чтобы начать быстрее.</div>
              </div>
            </li>

            <li class="flex items-start gap-3">
              <div class="mt-1 w-10 h-10 rounded-lg bg-white/60 dark:bg-gray-900/60 flex items-center justify-center font-semibold">⏱</div>
              <div>
                <div class="font-semibold">Отслеживание прогресса</div>
                <div class="text-sm text-gray-500">Понимайте, что двигается вперёд, а что требует внимания.</div>
              </div>
            </li>

            <li class="flex items-start gap-3">
              <div class="mt-1 w-10 h-10 rounded-lg bg-white/60 dark:bg-gray-900/60 flex items-center justify-center font-semibold">🔒</div>
              <div>
                <div class="font-semibold">Надёжность</div>
                <div class="text-sm text-gray-500">Мы заботимся о безопасности и конфиденциальности данных.</div>
              </div>
            </li>
          </ul>

          <div class="mt-8">
            <a href="{{ url_for('index') }}" class="inline-flex items-center gap-2 text-sm font-medium text-primary">← Вернуться на главную</a>
          </div>
        </div>
      </div>
    </div>

  </div>
</div>

{% endblock %}

{% block scripts %}
  {{ super() }}
  <script>
    // UI helpers: password toggle, strength meter and validation
    function togglePassword(id){
      const el = document.getElementById(id);
      if(!el) return;
      el.type = el.type === 'password' ? 'text' : 'password';
    }

    (function(){
      const pw = document.getElementById('password');
      const pwc = document.getElementById('password_confirm');
      const strength = document.getElementById('pw-strength');
      const help = document.getElementById('pw-help');
      const status = document.getElementById('pw-status');
      const btn = document.getElementById('register-btn');
      const agree = document.getElementById('agree_terms');

      function scorePassword(p){
        if(!p) return 0;
        let score = 0;
        if(p.length >= 8) score += 1;
        if(/[A-Z]/.test(p)) score += 1;
        if(/[0-9]/.test(p)) score += 1;
        if(/[^A-Za-z0-9]/.test(p)) score += 1;
        return score; // 0..4
      }

      function update(){
        if(!pw || !pwc || !strength || !help || !status || !btn) return;
        const s = scorePassword(pw.value);
        const pct = (s/4)*100;
        strength.style.width = pct + '%';
        // color via class toggles
        strength.className = 'h-full rounded-full ' + (s<=1 ? 'bg-red-400' : (s==2 ? 'bg-yellow-400' : 'bg-primary'));

        if(pw.value.length === 0){ help.textContent = '' }
        else if(s <=1){ help.textContent = 'Слабый пароль — добавьте цифры, заглавные буквы и символы.' }
        else if(s==2){ help.textContent = 'Средний пароль — можно усилить для безопасности.' }
        else { help.textContent = 'Хороший пароль.' }

        if(pw.value && pwc.value && pw.value !== pwc.value){ status.textContent = 'Пароли не совпадают'; status.className = 'text-sm font-medium text-red-600'; }
        else if(pw.value && pwc.value && pw.value === pwc.value){ status.textContent = 'Пароли совпадают'; status.className = 'text-sm font-medium text-green-600'; }
        else { status.textContent = ''; status.className = 'text-sm font-medium text-gray-500'; }

        // enable submit only if basic conditions met and terms agreed
        const ok = (s>=2) && (pw.value === pwc.value) && (agree ? agree.checked : true);
        btn.disabled = !ok;
        if(btn.disabled) btn.classList.add('opacity-60'); else btn.classList.remove('opacity-60');
      }

      if(pw){ pw.addEventListener('input', update); }
      if(pwc){ pwc.addEventListener('input', update); }
      if(agree){ agree.addEventListener('change', update); }
      // initial
      setTimeout(update, 100);
    })();
  </script>
{% endblock %}